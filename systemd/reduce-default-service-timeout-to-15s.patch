From 57d028aea7682b5f77822a670c8a745c6f704be1 Mon Sep 17 00:00:00 2001
From: Michael Catanzaro <mcatanzaro@redhat.com>
Date: Tue, 9 Aug 2022 10:33:27 -0500
Subject: [PATCH] Drop system and user timeouts to 15 seconds max

This implements: https://pagure.io/fedora-workstation/issue/163
---
 man/systemd-system.conf.xml | 2 +-
 src/basic/def.h             | 2 +-
 src/core/system.conf.in     | 4 ++--
 src/core/user.conf.in       | 4 ++--
 units/user@.service.in      | 2 +-
 5 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/man/systemd-system.conf.xml b/man/systemd-system.conf.xml
index b104044cc2..462678cfe9 100644
--- a/man/systemd-system.conf.xml
+++ b/man/systemd-system.conf.xml
@@ -364,7 +364,7 @@
         <varname>TimeoutSec=</varname>
         value. <varname>DefaultTimeoutStartSec=</varname> and
         <varname>DefaultTimeoutStopSec=</varname> default to
-        90s. <varname>DefaultTimeoutAbortSec=</varname> is not set by default
+        15s. <varname>DefaultTimeoutAbortSec=</varname> is not set by default
         so that all units fall back to <varname>TimeoutStopSec=</varname>.
         <varname>DefaultRestartSec=</varname> defaults to
         100ms.</para></listitem>
diff --git a/src/basic/def.h b/src/basic/def.h
index 0a1ae023a3..6043f3a0f4 100644
--- a/src/basic/def.h
+++ b/src/basic/def.h
@@ -1,7 +1,7 @@
 /* SPDX-License-Identifier: LGPL-2.1-or-later */
 #pragma once
 
-#define DEFAULT_TIMEOUT_USEC (90*USEC_PER_SEC)
+#define DEFAULT_TIMEOUT_USEC (15*USEC_PER_SEC)
 #define DEFAULT_RESTART_USEC (100*USEC_PER_MSEC)
 #define DEFAULT_CONFIRM_USEC (30*USEC_PER_SEC)
 
diff --git a/src/core/system.conf.in b/src/core/system.conf.in
index 67e55f10a2..e236540cbb 100644
--- a/src/core/system.conf.in
+++ b/src/core/system.conf.in
@@ -43,8 +43,8 @@
 #DefaultTimerAccuracySec=1min
 #DefaultStandardOutput=journal
 #DefaultStandardError=inherit
-#DefaultTimeoutStartSec=90s
-#DefaultTimeoutStopSec=90s
+#DefaultTimeoutStartSec=15s
+#DefaultTimeoutStopSec=15s
 #DefaultTimeoutAbortSec=
 #DefaultRestartSec=100ms
 #DefaultStartLimitIntervalSec=10s
diff --git a/src/core/user.conf.in b/src/core/user.conf.in
index e0a7703525..cffd9d5985 100644
--- a/src/core/user.conf.in
+++ b/src/core/user.conf.in
@@ -24,8 +24,8 @@
 #DefaultTimerAccuracySec=1min
 #DefaultStandardOutput=inherit
 #DefaultStandardError=inherit
-#DefaultTimeoutStartSec=90s
-#DefaultTimeoutStopSec=90s
+#DefaultTimeoutStartSec=15s
+#DefaultTimeoutStopSec=15s
 #DefaultTimeoutAbortSec=
 #DefaultRestartSec=100ms
 #DefaultStartLimitIntervalSec=10s
diff --git a/units/user@.service.in b/units/user@.service.in
index 85fc3c907e..ecdaeee7a0 100644
--- a/units/user@.service.in
+++ b/units/user@.service.in
@@ -23,6 +23,6 @@ Slice=user-%i.slice
 KillMode=mixed
 Delegate=pids memory
 TasksMax=infinity
-TimeoutStopSec=120s
+TimeoutStopSec=15s
 KeyringMode=inherit
 OOMScoreAdjust=100
-- 
2.37.1

